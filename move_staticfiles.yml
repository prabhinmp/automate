---
 - hosts:
   become:
   become_user:
   become_method: sudo
   vars:
     deploy_folder:
     backup_folder: /opt/backup/html_backup{{ansible_date_time.date}}
   tasks:
     - name: take backup of existing html folder
       stat:
         path: /opt/backup
       register: backup_folder
     - name: create backup folder if not exists
       file:
         path: /opt/backup
         state: directory
       when: backup_folder.stat.exists == false
     - name: create today's backup folder
       file:
         path: /opt/backup/html_backup{{ansible_date_time.date}}
         state: directory
     - name: mv the html folder to backup directory
       command: mv {{deploy_folder}}/home {{backup_folder}}
     - name: mv the admin folder to backup directory  
       command: mv {{deploy_folder}}/admin {{backup_folder}}
     - name: copy home folder to deploy folder
       copy:
         src: /opt/show/static_pages/home
         dest: "{{deploy_folder}}"
